# Augmented-Reality-Sandbox-ABL-Flow-
An Augmented Reality Sandbox devloped as a part of Masters's Thesis as a teaching tool for Atmospheric Boundary Layer Airflow
This Augmented Reality Sandbox software was made with inspiration from its following predecessors: 
 Sandbox from KeckCAVES at UC DAvis: https://arsandbox.ucdavis.edu/   
 GravBox at University of Iowa : http://astro.physics.uiowa.edu/gravbox/  

Here's how the AeolianBox lookes like in play   


![IMG_20190415_125410](https://user-images.githubusercontent.com/52681573/60850557-edadec00-a1bd-11e9-8f85-f7d206e2005c.jpg)
![IMG_20190415_131007](https://user-images.githubusercontent.com/52681573/60850560-ef77af80-a1bd-11e9-9f2a-0869c544f994.jpg)
![IMG_20190416_142508](https://user-images.githubusercontent.com/52681573/60850562-f1417300-a1bd-11e9-8de0-1da9693294d7.jpg)
![IMG_20190416_143214](https://user-images.githubusercontent.com/52681573/60850564-f272a000-a1bd-11e9-8727-e27d3daa6bd8.jpg)

 # Hardware Requirements 
 Same as GravBox and Sandbox from KeckCAVES. Check out their website ! 
 
 # Note:  
 1) The AeolianBox works for Kinect V1. However, if you were to update libfreenect, you can use this software for Kinect V2 as well.  
 
 2) Any other version of OpenFoam would work as well if your're not comfortable with "OpenFoam in a box". Just change the location of the .bashrc file for OpenFoam in /SimpleFoam/simplefoam.sh.  
 
 3) This software uses the calibration file boxlayout.txt generated from Sandbox made by KeckCAVES. Therefore, it's prior installation    is required. Simple copy paste that file in the Windsim_AR folder and you're good to go !  
 
 
# Installation Guide: Dependencies Installation  

To install AeolianBox, there is a need to first install appropriate Python libraries used in the software.   
1.	Install pip3 and setuptools by executing the following commands:   
    sudo apt install python3-pip  
    pip3 install setuptools  
2.	Install python libraries using pip3 by following commands:   
  pip3 install numpy  
  pip3 install opencv-python  
  pip3 install scipy  
  pip3 install stl_tools  
  pip3 install pygame  

3.	Libfreenect:In a new terminal, install the following modules required by libfreenect (Kinect’s driver for linux) by executing the following command:   
 sudo apt-get install git cmake build-essential libusb-1.0.0-dev    
  Fetch and build libfreenect using the following commands:     
    git clone https://github.com/OpenKinect/libfreenect  
    cd libfreenect  
    mkdir build   
    cd build   
    cmake -L   
    make  
  
 4.	OpenFoam: This software was devloped and tested only on OpenFoam V5
    sudo sh -c "wget -O - http://dl.openfoam.org/gpg.key | apt-key add -"  
    sudo add-apt-repository http://dl.openfoam.org/ubuntu  
    sudo apt-get update  
    sudo apt-get -y install openfoam5
    
    Add OpenFoam path to .bashrc file to use OpenFoam from terminal. 
	   gedit ~/.bashrc  
	   Add the following line at the end of the document.   
    source /opt/openfoam5/etc/bashrc  
    Save and close the document. Also close the terminal.   

  
5.	Paraview: Download “/ParaView-5.5.2-Qt5-MPI-Linux-64bit.tar.gz” from the following link:   
  https://www.paraview.org/download/   
  
    Go to the location of the file and open terminal to execute the following commands:  
  
    tar -xyz ParaView-5.5.2-Qt5-MPI-Linux-64bit.tar.gz  
    mv ParaView-5.5.2-Qt5-MPI-Linux-64bit /home/username  

# AeolianBox Setup  

1) Copy paste the folder Windsim_AR containing the AeolianBox software in your preferred directory (preferably in home/username). Copy and paste the boxlayout.txt calibration file generated by the ARS software from KeckCAVES in the Windsim_AR folder.  

2) Open file simplefoam.sh located in Windsim_AR. And edit lines 7, 26, 30 and 31 as following:   
   
    Line 26 (Location of Windsim_AR folder)  
   Only edit this line if the location of Windsim_AR file is other than the home directory.  

   if [ -d /home/$username/Windsim_AR/SimpleFoam/0 ];    

   Line 30 and 31 (Location of Paraview)  
   Only edit this line if a different than recommended version of Paraview was installed or/and the location is other than the home     directory.  

   cd /home/$username/ParaView-5.5.2-Qt5-MPI-Linux-64bit/bin  
   ./pvpython /home/$username/Windsim_AR/SimpleFoam/para_viz.py  

   Open para_viz.py and change the following lines:   
   Line 12  and 109 (Location of controlDict)   
   Change the username and the location of controlDict in Windsim_AR   
   OpenFOAMReader(FileName=’/home/username/Windsim_AR/SimpleFoam/system/controlDict’)  


   Line 362 (Location of saving animation of airflow)   
   Change the username to your machine's username.   
   Change the location for saving the animation in Windsim_AR only if not in home directory.     
   SaveAnimation(‘/home/username/Windsim_AR/SimpleFoam/sim.avi’, renderView1, ImageResolution=[1552, 804],
   FrameWindow=[5, 19])    
     
3.	To start the AeolianBox, two terminals are needed to be opened. In the first terminal, execute the following command and wait for it    to load and finish.

     python3 sandbox_wind.py  
   
     In the second terminal execute the following code and align the visualization to the sandbox bed by dragging and zooming using the   mouse.  
   
    python3 sim_play_gui.py  
  
# User Interaction 

To change the surface of the sandbox, the user can put their hand inside the sandbox and a 30 second timer would begin. If a change in the surface is detected, the flowfield is updated in approximately 30 seconds. Once the flow field is updated, a popup message mentioning “Sandbox Updated” is shown on the sandbed. Randomly putting hands of fingers inside the sandbox is highly discouraged because it can lead to the user’s hand being detected as a hand. An instructor is therefore advised to use a laser pointer in the classroom.   

The properties of the ABL flow, roughness length of the sand bed and number of cells in the mesh can be conveniently altered by editing the config file in the Windsim_AR folder. However, it is discouraged to use extreme values since it will require recalibration and recalculation of mesh parameters and certain flow properties respectively. 


